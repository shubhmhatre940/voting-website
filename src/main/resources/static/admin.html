<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - Bharat e-Voting</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Poppins', sans-serif; margin:0; background:#F4F6F8; }

        header {
            background:#fff; padding:18px 60px; display:flex;
            justify-content:space-between; align-items:center;
            box-shadow:0 2px 8px rgba(0,0,0,0.07);
        }
        header h2 { margin:0; color:#0D2E5E; }

        .logout-btn {
            background:#d9534f; border:none; color:white; padding:8px 16px;
            border-radius:6px; cursor:pointer; font-weight:500; font-size:14px;
        }
        .logout-btn:hover { background:#c9302c; }

        .container { padding:40px 60px; }

        .top-links a {
            margin-right:20px; font-weight:500;
            text-decoration:none; color:#0D2E5E;
        }
        .top-links a:hover { color:#F98D2E; }

        table { width:100%; border-collapse:collapse; margin-top:20px;
            background:white; border-radius:8px; overflow:hidden; }
        th, td { padding:12px; border-bottom:1px solid #eee; text-align:left; }
        th { background:#0D2E5E; color:white; }

        .btn-delete {
            background:#d9534f; color:white; border:none; padding:6px 10px;
            border-radius:6px; cursor:pointer; font-size:13px;
        }
        .btn-delete:hover { background:#c9302c; }
    </style>

</head>
<body>

<header>
    <h2>Admin Dashboard</h2>
    <button id="logoutBtn" class="logout-btn">Logout</button>
</header>

<div class="container">

    <div class="top-links">
        <a href="add_candidate.html">Add Candidate</a>
        <a href="results.html">View Results</a>
    </div>

    <h3>Candidate List</h3>

    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Party</th>
            <th>Votes</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody id="candidateTable"></tbody>
    </table>

</div>

<script>

    // ✅ BLOCK UNAUTHORIZED ACCESS
    if (localStorage.getItem("admin") !== "true") {
        window.location = "admin_login.html";
    }

    async function loadCandidates() {
      const res = await fetch('/api/admin/candidates');
      const list = await res.json();
      const table = document.getElementById('candidateTable');
      table.innerHTML = '';

      list.forEach(c => {
        table.innerHTML += `
          <tr>
            <td>${c.id}</td>
            <td>${c.name}</td>
            <td>${c.party}</td>
            <td>${c.votes}</td>
            <td><button class="btn-delete" data-id="${c.id}">Delete</button></td>
          </tr>
        `;
      });
    }

    document.addEventListener('click', async (e) => {
      if (e.target.classList.contains('btn-delete')) {
        const id = e.target.getAttribute('data-id');
        if (confirm("Are you sure you want to delete this candidate?")) {
          await fetch(`/api/admin/candidates/${id}`, { method: 'DELETE' });
          loadCandidates();
        }
      }
    });

    // ✅ Logout Button Action
    document.getElementById('logoutBtn').addEventListener('click', () => {
        localStorage.removeItem("admin"); // ✅ Remove session
        window.location = "admin_login.html";
    });

    loadCandidates();

</script>

</body>
</html>
